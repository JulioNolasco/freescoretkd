// TODO actually recognize syntax of TypeScript constructs
CodeMirror.defineMode("javascript",function(e,t){function nt(e,t,n){t[p]=n;return n(e,t)}function rt(e,t){var n=m,r;while((r=e.next())!=u){if(r==t&&!n)return m;n=!n&&r=="\\"}return n}function ot(e,t,n){it=e;st=n;return t}function ut(e,t){var r=e.next();if(r=='"'||r=="'")return nt(e,t,at(r));if(/[\[\]{}\(\),;\:\.]/[I](r))return ot(r);if(r=="0"&&e.eat(/x/i)){e[x](/[\da-f]/i);return ot(g,g)}if(/\d/[I](r)||r=="-"&&e.eat(/\d/)){e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/);return ot(g,g)}if(r==z){if(e.eat("*"))return nt(e,t,ft);if(e.eat(z)){e.skipToEnd();return ot(d,d)}if(t[a]==i||t[a]==C||/^[\[{}\(,;:]$/[I](t[a])){rt(e,z);e[x](/[gimy]/);return ot("regexp","string-2")}e[x](tt);return ot(i,u,e[R]())}if(r=="#"){e.skipToEnd();return ot(W,W)}if(tt[I](r)){e[x](tt);return ot(i,u,e[R]())}e[x](/[\w\$_]/);var s=e[R](),o=et.propertyIsEnumerable(s)&&et[s];return o&&t[a]!="."?ot(o[D],o.style,s):ot(n,n,s)}function at(e){return function(t,n){rt(t,e)||(n[p]=ut);return ot(O,O)}}function ft(e,t){var n=m,r;while(r=e.next()){if(r==z&&n){t[p]=ut;break}n=r=="*"}return ot(d,d)}function ct(e,t,n,r,i,o){this[s]=e;this[K]=t;this[D]=n;this[B]=i;this.info=o;r!=u&&(this[L]=r)}function ht(e,t){for(var n=e[o];n;n=n.next)if(n.name==t)return c}function pt(e,t,i,s,o){var a=e.cc;dt[f]=e;dt.stream=o;dt[v]=u,dt.cc=a;e[r][h](L)||(e[r][L]=c);while(c){var l=a[j]?a.pop():Y?Nt:Tt;if(l(i,s)){while(a[j]&&a[a[j]-1].lex)a.pop()();return dt[v]?dt[v]:i==n&&ht(e,s)?"variable-2":t}}}function vt(){for(var e=arguments[j]-1;e>=0;e--)dt.cc.push(arguments[e])}function mt(){vt.apply(u,arguments);return c}function gt(e){function t(t){for(var n=t;n;n=n.next)if(n.name==e)return c;return m}var n=dt[f];if(n[w]){dt[v]="def";if(t(n[o]))return;n[o]={name:e,next:n[o]}}else{if(t(n[S]))return;n[S]={name:e,next:n[S]}}}function bt(){dt[f][w]={prev:dt[f][w],vars:dt[f][o]};dt[f][o]=yt}function wt(){dt[f][o]=dt[f][w].vars;dt[f][w]=dt[f][w][B]}function Et(e,t){var n=function(){var n=dt[f],i=n[s];n[r][D]==y&&(i=n[r][s]);n[r]=new ct(i,dt.stream[K](),e,u,n[r],t)};n.lex=c;return n}function St(){var e=dt[f];if(e[r][B]){e[r][D]==b&&(e[s]=e[r][s]);e[r]=e[r][B]}}function xt(e){return function(t){return t==e?mt():e==T?vt():mt(arguments.callee)}}function Tt(e){return e==A?mt(Et(q),qt,xt(T),St):e==P?mt(Et(l),Nt,Tt,St):e==N?mt(Et(l),Tt,St):e==U?mt(Et(H),jt,St):e==T?mt():e=="if"?mt(Et(l),Nt,Tt,St,Ut(dt[f][s])):e==k?mt($t):e=="for"?mt(Et(l),xt("("),Et(b),zt,xt(b),St,Tt,St):e==n?mt(Et(y),_t):e==E?mt(Et(l),Nt,Et(H,E),xt(U),jt,St,St):e==V?mt(Nt,xt($)):e==F?mt(xt($)):e==X?mt(Et(l),bt,xt("("),Jt,xt(b),Tt,St,wt):vt(Et(y),Nt,xt(T),St)}function Nt(e){return kt(e,m)}function Ct(e){return kt(e,c)}function kt(e,t){var n=t?Mt:Ot;return lt[h](e)?mt(n):e==k?mt($t):e==C?mt(t?At:Lt):e=="("?mt(Et(b),Lt,xt(b),St,n):e==i?mt(t?Ct:Nt):e=="["?mt(Et("]"),Bt(Ct,"]"),St,n):e==U?mt(Et(H),Bt(Pt,H),St,n):mt()}function Lt(e){return e.match(/[;\}\)\],]/)?vt():vt(Nt)}function At(e){return e.match(/[;\}\)\],]/)?vt():vt(Ct)}function Ot(e,t){return e==","?mt(Nt):Mt(e,t,Ot)}function Mt(e,t,n){n||(n=Mt);if(e==i)return/\+\+|--/[I](t)?mt(n):t=="?"?mt(Nt,xt($),Nt):mt(Nt);if(e==T)return;if(e=="(")return mt(Et(b,"call"),Bt(Ct,b),St,n);if(e==".")return mt(Dt,n);if(e=="[")return mt(Et("]"),Nt,xt("]"),St,n)}function _t(e){return e==$?mt(St,Tt):vt(Ot,xt(T),St)}function Dt(e){if(e==n){dt[v]=M;return mt()}}function Pt(e,t){if(e==n){dt[v]=M;if(t=="get"||t=="set")return mt(Ht)}else if(e==g||e==O)dt[v]=e+" property";if(lt[h](e))return mt(xt($),Ct)}function Ht(e){if(e==$)return mt(Nt);if(e!=n)return mt(xt($),Nt);dt[v]=M;return mt($t)}function Bt(e,t){function n(i){if(i==","){var s=dt[f][r];s.info=="call"&&(s.pos=(s.pos||0)+1);return mt(e,n)}return i==t?mt():mt(xt(t))}return function(r){return r==t?mt():vt(e,n)}}function jt(e){return e==H?mt():vt(Tt,jt)}function Ft(e){return e==$?mt(It):vt()}function It(e){if(e==n){dt[v]=_;return mt()}return vt()}function qt(e,t){if(e==n){gt(t);return Z?mt(Ft,Rt):mt(Rt)}return vt()}function Rt(e,t){if(t=="=")return mt(Ct,Rt);if(e==",")return mt(qt)}function Ut(e){return function(t,n){if(t==N&&n=="else"){dt[f][r]=new ct(e,0,l,u,dt[f][r]);return mt(Tt,St)}return vt()}}function zt(e){return e==A?mt(qt,xt(T),Xt):e==T?mt(Xt):e==n?mt(Wt):vt(Nt,xt(T),Xt)}function Wt(e,t){return t=="in"?mt(Nt):mt(Ot,Xt)}function Xt(e,t){return e==T?mt(Vt):t=="in"?mt(Nt):vt(Nt,xt(T),Vt)}function Vt(e){e!=b&&mt(Nt)}function $t(e,t){if(e==n){gt(t);return mt($t)}if(e=="(")return mt(Et(b),bt,Bt(Jt,b),St,Tt,wt)}function Jt(e,t){if(e==n){gt(t);return Z?mt(Ft):mt()}}var n="variable",r="lexical",i="operator",s="indented",o="localVars",u=null,a="lastType",f="state",l="form",c=!0,h="hasOwnProperty",p="tokenize",d="comment",v="marked",m=!1,g="number",y="stat",b=")",w="context",E="switch",S="globalVars",x="eatWhile",T=";",N="keyword b",C="keyword c",k="function",L="align",A="var",O="string",M="property",_="variable-3",D="type",P="keyword a",H="}",B="prev",j="length",F="default",I="test",q="vardef",R="current",U="{",z="/",W="error",X="catch",V="case",$=":",J="this",K="column",Q=e.indentUnit,G=t.statementIndent,Y=t.json,Z=t.typescript,et=function(){function e(e){return{type:e,style:"keyword"}}var t=e(P),r=e(N),s=e(C),o=e(i),u={type:"atom",style:"atom"},a={"if":e("if"),"while":t,"with":t,"else":r,"do":r,"try":r,"finally":r,"return":s,"break":s,"continue":s,"new":s,"delete":s,"throw":s,"var":e(A),"const":e(A),let:e(A),"function":e(k),"catch":e(X),"for":e("for"),"switch":e(E),"case":e(V),"default":e(F),"in":o,"typeof":o,"instanceof":o,"true":u,"false":u,"null":u,"undefined":u,NaN:u,Infinity:u,"this":e(J)};if(Z){var f={type:n,style:_},l={"interface":e("interface"),"class":e("class"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),"super":e("super"),string:f,number:f,bool:f,any:f};for(var c in l)a[c]=l[c]}return a}(),tt=/[+\-*&%=<>!?|~^]/,it,st,lt={atom:c,number:c,variable:c,string:c,regexp:c,"this":c},dt={state:u,column:u,marked:u,cc:u},yt={name:J,next:{name:"arguments"}};St.lex=c;return{startState:function(e){return{tokenize:ut,lastType:u,cc:[],lexical:new ct((e||0)-Q,0,"block",m),localVars:t[o],globalVars:t[S],context:t[o]&&{vars:t[o]},indented:0}},token:function(e,t){if(e.sol()){t[r][h](L)||(t[r][L]=m);t[s]=e.indentation()}if(t[p]!=ft&&e.eatSpace())return u;var n=t[p](e,t);if(it==d)return n;t[a]=it!=i||st!="++"&&st!="--"?it:"incdec";return pt(t,n,it,st,e)},indent:function(e,n){if(e[p]==ft)return CodeMirror.Pass;if(e[p]!=ut)return 0;var o=n&&n.charAt(0),u=e[r];u[D]==y&&o==H&&(u=u[B]);G&&u[D]==b&&u[B][D]==y&&(u=u[B]);var f=u[D],c=o==f;return f==q?u[s]+(e[a]==i||e[a]==","?4:0):f==l&&o==U?u[s]:f==l?u[s]+Q:f==y?u[s]+(e[a]==i||e[a]==","?G||Q:0):u.info==E&&!c&&t.doubleIndentSwitch!=m?u[s]+(/^(?:case|default)\b/[I](n)?Q:2*Q):u[L]?u[K]+(c?0:1):u[s]+(c?0:Q)},electricChars:":{}",blockCommentStart:Y?u:"/*",blockCommentEnd:Y?u:"*/",lineComment:Y?u:"//",jsonMode:Y}});(function(){var e="defineMIME",t="javascript",n=!0;CodeMirror[e]("text/javascript",t);CodeMirror[e]("text/ecmascript",t);CodeMirror[e]("application/javascript",t);CodeMirror[e]("application/ecmascript",t);CodeMirror[e]("application/json",{name:t,json:n});CodeMirror[e]("application/x-json",{name:t,json:n});CodeMirror[e]("text/typescript",{name:t,typescript:n});CodeMirror[e]("application/typescript",{name:t,typescript:n})})();

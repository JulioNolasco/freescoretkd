(function(e){var t="#code",n="ncanvases",r="console",i="cursor",s="editor",o="focused",u="removeClass",a="getValue",f="localStorage",l="jcanvas-sandbox",c="error";e(document).ready(function(){function m(){var e;if(window[f]&&window.JSON){p=localStorage.getItem(l);p=JSON.parse(p);if(p!==null){h[n].val(p[n]);b();p[i]&&d.setCursor(p[i])}else p={}}return e}function g(){if(window[f]&&window.JSON){p[i]=d.getCursor();localStorage.setItem(l,JSON.stringify(p))}window.location.search="?code="+encodeURIComponent(d[a]())}function y(){h.code[u](c);h[r].html("");try{(new Function(d[a]()))()}catch(e){h.code.addClass(c);h[r].html(e.message);console[c](e.stack||String(e))}}function b(){var t,r,i;p[n]=parseFloat(h[n].val());i=Math.round(452/p[n]);t="";for(r=0;r<p[n];r+=1)t+='<canvas width="360" height="'+i+'"></canvas>';h.canvases.html(t);h.canvas=e("canvas")}e(".images").hide();var h={};h.win=e(window);h.code=e(t);h.sample=e("#sample");h.run=e("#run");h.canvases=e("#canvases");h[n]=e("#ncanvases");h[r]=e("#console");var p={};p[n]=1;p[i]={line:0,ch:0};var d=CodeMirror(e(t)[0],{value:h.sample.text(),lineNumbers:!0});d.on("focus",function(e){h[s].addClass(o)});d.on("blur",function(e){h[s][u](o)});h[s]=e("div.CodeMirror");var v=d[a]("\n");h.run.on("click",function(){g()});h.code.on("keydown",function(e){if(e.metaKey||e.ctrlKey)if(e.which===13){g();return!1}});h[n].on("change",function(){b();g()});m();y();"ontouchstart"in document||d.focus()})})(jQuery);